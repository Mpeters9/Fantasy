<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Stats</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>
<body class="bg-purple-900 text-cyan-200 min-h-screen">
    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold mb-4 text-center">Player Stats</h1>
        <div class="card mb-4">
            <div class="flex flex-col sm:flex-row gap-4">
                <div class="flex-1">
                    <label for="yearSelect" class="block text-sm font-medium">Select Year:</label>
                    <select id="yearSelect" class="mt-1 block w-full bg-purple-800/50 border border-cyan-400 rounded-md p-2 text-sm">
                        <option value="2025">2025</option>
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                    </select>
                </div>
                <div class="flex-1">
                    <label for="positionSelect" class="block text-sm font-medium">Select Position:</label>
                    <select id="positionSelect" class="mt-1 block w-full bg-purple-800/50 border border-cyan-400 rounded-md p-2 text-sm">
                        <option value="all">All</option>
                        <option value="QB">QB</option>
                        <option value="RB">RB</option>
                        <option value="WR">WR</option>
                        <option value="TE">TE</option>
                        <option value="Flex">Flex (RB/WR/TE)</option>
                        <option value="SuperFlex">SuperFlex (QB/RB/WR/TE)</option>
                    </select>
                </div>
                <div class="flex-1">
                    <label for="playerSelect" class="block text-sm font-medium">Select Player:</label>
                    <select id="playerSelect" class="mt-1 block w-full bg-purple-800/50 border border-cyan-400 rounded-md p-2 text-sm">
                        <option value="all">All Players</option>
                    </select>
                </div>
            </div>
            <div class="mt-2">
                <input type="checkbox" id="advancedStatsCheckbox" class="mr-2">
                <label for="advancedStatsCheckbox" class="text-sm">Show Advanced Stats</label>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table id="statsTable" class="w-full bg-purple-800/50 backdrop-blur-md rounded-lg shadow-md text-sm">
                <thead>
                    <tr class="bg-purple-700/60">
                        <th class="p-2">Player</th>
                        <th class="p-2">Team</th>
                        <th class="p-2">Fantasy Points</th>
                        <th class="p-2">FP/G</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="4" class="p-2 text-center">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    <script>
        const yearSelect = document.getElementById('yearSelect');
        const positionSelect = document.getElementById('positionSelect');
        const playerSelect = document.getElementById('playerSelect');
        const advancedStatsCheckbox = document.getElementById('advancedStatsCheckbox');
        const statsTable = document.getElementById('statsTable');

        let currentYearData = [];
        let currentYear = '2025';

        async function loadYearData(year) {
            try {
                const response = await fetch(`players_${year}.json`);
                if (!response.ok) throw new Error(`Failed to load players_${year}.json`);
                currentYearData = await response.json();
                currentYear = year;
                populatePlayerDropdown();
                updateTable();
            } catch (error) {
                console.error('Error loading year data:', error);
                statsTable.querySelector('tbody').innerHTML = '<tr><td colspan="4" class="p-2 text-center text-red-400">Failed to load player data.</td></tr>';
            }
        }

        function populatePlayerDropdown() {
            playerSelect.innerHTML = '<option value="all">All Players</option>';
            currentYearData.forEach(player => {
                const option = document.createElement('option');
                option.value = player.name;
                option.textContent = player.name;
                playerSelect.appendChild(option);
            });
        }

        function calculateFantasyPoints(player) {
            if (player.position === 'QB') {
                const passingYardsPoints = (player.passingYards || 0) / 25;
                const passingTDsPoints = (player.passingTDs || 0) * 4;
                const interceptionsPoints = (player.interceptions || 0) * -2;
                const rushingYardsPoints = (player.rushingYards || 0) / 10;
                const rushingTDsPoints = (player.rushingTDs || 0) * 6;
                return passingYardsPoints + passingTDsPoints + interceptionsPoints + rushingYardsPoints + rushingTDsPoints;
            } else if (['RB', 'WR', 'TE'].includes(player.position)) {
                const rushingYardsPoints = (player.rushingYards || 0) / 10;
                const rushingTDsPoints = (player.rushingTDs || 0) * 6;
                const receivingYardsPoints = (player.receivingYards || 0) / 10;
                const receivingTDsPoints = (player.receivingTDs || 0) * 6;
                const receptionsPoints = (player.receptions || 0) * 1;
                return rushingYardsPoints + rushingTDsPoints + receivingYardsPoints + receivingTDsPoints + receptionsPoints;
            }
            return 0;
        }

        function updateTable() {
            const selectedPosition = positionSelect.value;
            const selectedPlayer = playerSelect.value;
            const showAdvanced = advancedStatsCheckbox.checked && ['QB', 'RB', 'WR', 'TE'].includes(selectedPosition);

            let filteredPlayers = currentYearData;
            if (selectedPosition === 'Flex') {
                filteredPlayers = filteredPlayers.filter(p => ['RB', 'WR', 'TE'].includes(p.position));
            } else if (selectedPosition === 'SuperFlex') {
                filteredPlayers = filteredPlayers.filter(p => ['QB', 'RB', 'WR', 'TE'].includes(p.position));
            } else if (selectedPosition !== 'all') {
                filteredPlayers = filteredPlayers.filter(p => p.position === selectedPosition);
            }
            if (selectedPlayer !== 'all') {
                filteredPlayers = filteredPlayers.filter(p => p.name === selectedPlayer);
            }

            const tableRows = filteredPlayers.map(player => {
                const fantasyPoints = currentYear === '2025' ? player.fantasy_points : calculateFantasyPoints(player);
                const games = currentYear === '2025' ? 17 : (player.gamesPlayed || 17);
                const fpPerGame = fantasyPoints / games;
                let row = `<tr>
                    <td class="p-2">${player.name}</td>
                    <td class="p-2">${player.team}</td>
                    <td class="p-2">${fantasyPoints.toFixed(1)}</td>
                    <td class="p-2">${fpPerGame.toFixed(1)}</td>
                </tr>`;
                if (showAdvanced && player.stats && currentYear !== '2025') {
                    if (player.position === 'QB') {
                        row = row.replace('</tr>', `
                            <td class="p-2">${player.stats.passingYards || 'N/A'}</td>
                            <td class="p-2">${player.stats.passingTDs || 'N/A'}</td>
                            <td class="p-2">${player.stats.interceptions || 'N/A'}</td>
                            </tr>`);
                    } else if (player.position === 'RB') {
                        row = row.replace('</tr>', `
                            <td class="p-2">${player.stats.rushingYards || 'N/A'}</td>
                            <td class="p-2">${player.stats.rushingTDs || 'N/A'}</td>
                            <td class="p-2">${player.stats.receptions || 'N/A'}</td>
                            </tr>`);
                    } else if (player.position === 'WR' || player.position === 'TE') {
                        row = row.replace('</tr>', `
                            <td class="p-2">${player.stats.receivingYards || 'N/A'}</td>
                            <td class="p-2">${player.stats.receivingTDs || 'N/A'}</td>
                            <td class="p-2">${player.stats.receptions || 'N/A'}</td>
                            </tr>`);
                    }
                } else if (currentYear === '2025') {
                    row = row.replace('</tr>', `
                        <td class="p-2">${player.stats.total_yards}</td>
                        <td class="p-2">${player.stats.total_touchdowns}</td>
                        </tr>`);
                }
                return row;
            }).join('');

            let header = `<tr class="bg-purple-700/60">
                <th class="p-2">Player</th>
                <th class="p-2">Team</th>
                <th class="p-2">Fantasy Points</th>
                <th class="p-2">FP/G</th>
            </tr>`;
            if (showAdvanced && currentYear !== '2025' && filteredPlayers.length > 0) {
                const pos = filteredPlayers[0].position;
                if (pos === 'QB') {
                    header = header.replace('</tr>', `
                        <th class="p-2">Passing Yards</th>
                        <th class="p-2">Passing TDs</th>
                        <th class="p-2">Interceptions</th>
                        </tr>`);
                } else if (pos === 'RB') {
                    header = header.replace('</tr>', `
                        <th class="p-2">Rushing Yards</th>
                        <th class="p-2">Rushing TDs</th>
                        <th class="p-2">Receptions</th>
                        </tr>`);
                } else if (pos === 'WR' || pos === 'TE') {
                    header = header.replace('</tr>', `
                        <th class="p-2">Receiving Yards</th>
                        <th class="p-2">Receiving TDs</th>
                        <th class="p-2">Receptions</th>
                        </tr>`);
                }
            } else if (currentYear === '2025') {
                header = header.replace('</tr>', `
                    <th class="p-2">Total Yards</th>
                    <th class="p-2">Total Touchdowns</th>
                    </tr>`);
            }

            statsTable.innerHTML = `<thead>${header}</thead><tbody>${tableRows || '<tr><td colspan="6" class="p-2 text-center">No players found.</td></tr>'}</tbody>`;
        }

        positionSelect.addEventListener('change', () => {
            const selected = positionSelect.value;
            advancedStatsCheckbox.disabled = !['QB', 'RB', 'WR', 'TE'].includes(selected);
            if (advancedStatsCheckbox.disabled) advancedStatsCheckbox.checked = false;
            updateTable();
        });
        yearSelect.addEventListener('change', () => loadYearData(yearSelect.value));
        playerSelect.addEventListener('change', updateTable);
        advancedStatsCheckbox.addEventListener('change', updateTable);

        loadYearData('2025');
    </script>
</body>
</html>
