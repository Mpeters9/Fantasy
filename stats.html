<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Football Stats - Front Row Fantasy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; }
        th, td { border: 1px solid #ddd; text-align: center; }
        th { background-color: #f4f4f4; cursor: pointer; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        tr:hover { background-color: #f1f1f1; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <header class="bg-gradient-to-r from-blue-800 to-blue-600 text-white py-4 shadow-md">
        <div class="max-w-7xl mx-auto flex justify-between items-center px-6">
            <div class="flex items-center gap-4">
                <img src="logo.png" alt="Logo" class="h-12" onerror="this.src='https://via.placeholder.com/48?text=FRF'">
                <h1 class="text-3xl font-bold">Fantasy Football Stats</h1>
            </div>
        </div>
    </header>
    <main class="max-w-7xl mx-auto p-6">
        <section class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg">
            <h2 class="text-2xl font-bold mb-6 text-gray-900 dark:text-white">Player Stats</h2>
            <div class="mb-4 flex gap-4">
                <div>
                    <label for="yearSelect" class="block text-gray-700 dark:text-gray-300">Select Year:</label>
                    <select id="yearSelect" class="p-2 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white">
                        <option value="2025">2025</option>
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                    </select>
                </div>
                <div>
                    <label for="positionSelect" class="block text-gray-700 dark:text-gray-300">Select Position:</label>
                    <select id="positionSelect" class="p-2 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white">
                        <option value="QB">QB</option>
                        <option value="RB">RB</option>
                        <option value="WR">WR</option>
                        <option value="TE">TE</option>
                        <option value="Flex">Flex (RB/WR/TE)</option>
                        <option value="SuperFlex">SuperFlex (QB/RB/WR/TE)</option>
                    </select>
                </div>
                <div>
                    <label for="playerSelect" class="block text-gray-700 dark:text-gray-300">Select Player:</label>
                    <select id="playerSelect" class="p-2 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white">
                        <option value="">All Players</option>
                    </select>
                </div>
                <button id="toggleAdvanced" class="mt-6 bg-teal-500 text-white px-4 py-2 rounded-lg hover:bg-teal-600 transition">Show Advanced Stats</button>
            </div>
            <div id="statsTable" class="overflow-x-auto">
                <table class="min-w-full bg-white dark:bg-gray-800">
                    <thead>
                        <tr>
                            <th class="px-4 py-2">Player</th>
                            <th class="px-4 py-2">Team</th>
                            <th class="px-4 py-2">Fantasy Points</th>
                            <th class="px-4 py-2">FP/G</th>
                        </tr>
                    </thead>
                    <tbody id="statsBody">
                        <tr><td colspan="4" class="text-center py-4">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const yearSelect = document.getElementById('yearSelect');
            const positionSelect = document.getElementById('positionSelect');
            const playerSelect = document.getElementById('playerSelect');
            const statsBody = document.getElementById('statsBody');
            const toggleAdvanced = document.getElementById('toggleAdvanced');
            let playersData = [];
            let activePlayers = [];
            let currentYear = '2025';
            let currentPosition = 'QB';
            let currentPlayer = '';
            let showAdvanced = false;

            // Fetch active players
            fetch('active_players.json')
                .then(response => response.json())
                .then(data => {
                    activePlayers = data;
                    populatePlayerSelect();
                })
                .catch(error => console.error('Error loading active players:', error));

            // Fetch data based on selected year
            function fetchData(year) {
                fetch(`players_${year}.json`)
                    .then(response => {
                        if (!response.ok) throw new Error('Network response was not ok');
                        return response.json();
                    })
                    .then(data => {
                        playersData = data;
                        renderTable(currentPosition, currentPlayer);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        statsBody.innerHTML = '<tr><td colspan="4" class="text-center text-red-600">Failed to load data.</td></tr>';
                    });
            }

            // Populate player dropdown
            function populatePlayerSelect() {
                playerSelect.innerHTML = '<option value="">All Players</option>';
                activePlayers.forEach(player => {
                    const option = document.createElement('option');
                    option.value = player.name;
                    option.textContent = `${player.name} (${player.position})`;
                    playerSelect.appendChild(option);
                });
            }

            yearSelect.addEventListener('change', (event) => {
                currentYear = event.target.value;
                fetchData(currentYear);
            });

            positionSelect.addEventListener('change', (event) => {
                currentPosition = event.target.value;
                renderTable(currentPosition, currentPlayer);
            });

            playerSelect.addEventListener('change', (event) => {
                currentPlayer = event.target.value;
                renderTable(currentPosition, currentPlayer);
            });

            toggleAdvanced.addEventListener('click', () => {
                showAdvanced = !showAdvanced;
                toggleAdvanced.textContent = showAdvanced ? 'Hide Advanced Stats' : 'Show Advanced Stats';
                renderTable(currentPosition, currentPlayer);
            });

            function renderTable(position, player) {
                statsBody.innerHTML = '';
                let filteredPlayers = playersData.filter(p => {
                    const posMatch = position === 'Flex' || position === 'SuperFlex'
                        ? (position === 'SuperFlex' || p.position !== 'QB')
                        : p.position === position;
                    const playerMatch = !player || p.name === player;
                    return posMatch && playerMatch;
                });

                filteredPlayers.sort((a, b) => calculateFantasyPoints(b) - calculateFantasyPoints(a));

                const columns = getColumns(position, showAdvanced);
                const thead = document.querySelector('thead tr');
                thead.innerHTML = '<th class="px-4 py-2">Player</th><th class="px-4 py-2">Team</th><th class="px-4 py-2">Fantasy Points</th><th class="px-4 py-2">FP/G</th>';
                columns.forEach(col => {
                    const th = document.createElement('th');
                    th.className = 'px-4 py-2';
                    th.textContent = col.label;
                    thead.appendChild(th);
                });

                filteredPlayers.forEach(player => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-2">${player.name}</td>
                        <td class="px-4 py-2">${player.team || 'N/A'}</td>
                        <td class="px-4 py-2">${calculateFantasyPoints(player).toFixed(2)}</td>
                        <td class="px-4 py-2">${(calculateFantasyPoints(player) / (player.gamesPlayed || 1)).toFixed(2)}</td>
                    `;
                    columns.forEach(col => {
                        const td = document.createElement('td');
                        td.className = 'px-4 py-2';
                        td.textContent = player[col.key] ? player[col.key].toFixed(2) : 'N/A';
                        row.appendChild(td);
                    });
                    statsBody.appendChild(row);
                });
            }

            function calculateFantasyPoints(player) {
                let points = 0;
                if (player.position === 'QB') {
                    points += (player.passingYards || 0) / 25;
                    points += (player.passingTDs || 0) * 4;
                    points -= (player.interceptions || 0) * 2;
                    points += (player.rushingYards || 0) / 10;
                    points += (player.rushingTDs || 0) * 6;
                }
                if (['RB', 'WR', 'TE'].includes(player.position)) {
                    points += (player.rushingYards || 0) / 10;
                    points += (player.rushingTDs || 0) * 6;
                    points += player.receptions || 0;
                    points += (player.receivingYards || 0) / 10;
                    points += (player.receivingTDs || 0) * 6;
                }
                return points;
            }

            function getColumns(position, advanced) {
                const baseColumns = {
                    QB: [
                        { label: 'Pass Yds', key: 'passingYards' },
                        { label: 'Pass TDs', key: 'passingTDs' },
                        { label: 'Int', key: 'interceptions' },
                        { label: 'Rush Yds', key: 'rushingYards' },
                        { label: 'Rush TDs', key: 'rushingTDs' },
                        { label: 'Comp %', key: 'completionPercentage' },
                        { label: 'YPA', key: 'yardsPerAttempt' },
                        { label: 'QB Rating', key: 'qbRating' },
                    ],
                    RB: [
                        { label: 'Rush Yds', key: 'rushingYards' },
                        { label: 'Rush TDs', key: 'rushingTDs' },
                        { label: 'Rec', key: 'receptions' },
                        { label: 'Rec Yds', key: 'receivingYards' },
                        { label: 'Rec TDs', key: 'receivingTDs' },
                        { label: 'YPC', key: 'yardsPerCarry' },
                        { label: 'YPR', key: 'yardsPerReception' },
                        { label: 'Touches', key: 'touches' },
                    ],
                    WR: [
                        { label: 'Rec', key: 'receptions' },
                        { label: 'Rec Yds', key: 'receivingYards' },
                        { label: 'Rec TDs', key: 'receivingTDs' },
                        { label: 'Targets', key: 'targets' },
                        { label: 'YPR', key: 'yardsPerReception' },
                        { label: 'Catch %', key: 'catchRate' },
                        { label: 'YAC', key: 'yardsAfterCatch' },
                    ],
                    TE: [
                        { label: 'Rec', key: 'receptions' },
                        { label: 'Rec Yds', key: 'receivingYards' },
                        { label: 'Rec TDs', key: 'receivingTDs' },
                        { label: 'Targets', key: 'targets' },
                        { label: 'YPR', key: 'yardsPerReception' },
                        { label: 'Catch %', key: 'catchRate' },
                        { label: 'YAC', key: 'yardsAfterCatch' },
                    ],
                    Flex: [
                        { label: 'Pos', key: 'position' },
                        { label: 'Rush Yds', key: 'rushingYards' },
                        { label: 'Rush TDs', key: 'rushingTDs' },
                        { label: 'Rec', key: 'receptions' },
                        { label: 'Rec Yds', key: 'receivingYards' },
                        { label: 'Rec TDs', key: 'receivingTDs' },
                    ],
                    SuperFlex: [
                        { label: 'Pos', key: 'position' },
                        { label: 'Pass Yds', key: 'passingYards' },
                        { label: 'Pass TDs', key: 'passingTDs' },
                        { label: 'Int', key: 'interceptions' },
                        { label: 'Rush Yds', key: 'rushingYards' },
                        { label: 'Rush TDs', key: 'rushingTDs' },
                        { label: 'Rec', key: 'receptions' },
                        { label: 'Rec Yds', key: 'receivingYards' },
                        { label: 'Rec TDs', key: 'receivingTDs' },
                    ],
                };

                const advancedColumns = {
                    QB: [
                        { label: 'AYPA', key: 'adjustedYardsPerAttempt' },
                        { label: 'CPOE', key: 'completionPercentageOverExpectation' },
                        { label: 'Deep %', key: 'deepBallCompletionPercentage' },
                    ],
                    RB: [
                        { label: 'YACo', key: 'yardsAfterContact' },
                        { label: 'Elusive', key: 'elusiveRating' },
                        { label: 'Break %', key: 'breakawayRunRate' },
                    ],
                    WR: [
                        { label: 'YPPR', key: 'yardsPerPassRoute' },
                        { label: 'Air Yds', key: 'airYards' },
                        { label: 'Tgt Share', key: 'targetShare' },
                        { label: 'RZ Tgts', key: 'redZoneTargets' },
                    ],
                    TE: [
                        { label: 'YPPR', key: 'yardsPerPassRoute' },
                        { label: 'Air Yds', key: 'airYards' },
                        { label: 'Tgt Share', key: 'targetShare' },
                        { label: 'RZ Tgts', key: 'redZoneTargets' },
                    ],
                    Flex: [
                        { label: 'YPPR', key: 'yardsPerPassRoute' },
                        { label: 'Tgt Share', key: 'targetShare' },
                    ],
                    SuperFlex: [
                        { label: 'YPPR', key: 'yardsPerPassRoute' },
                        { label: 'Tgt Share', key: 'targetShare' },
                        { label: 'AYPA', key: 'adjustedYardsPerAttempt' },
                    ],
                };

                return advanced ? [...baseColumns[position], ...advancedColumns[position]] : baseColumns[position];
            }

            // Initial data fetch
            fetchData(currentYear);
        });
    </script>
</body>
</html>